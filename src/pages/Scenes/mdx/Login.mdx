import SceneModule from '@/components/SceneModule';

import BasicUse from '../modules/login/BasicUse';
import BasicUseCss from '../modules/login/BasicUse/index.module.less?raw';
import BasicUseTypeScript from '../modules/login/BasicUse/index.tsx?raw';

# 登录

初始化网易云信即时通讯 SDK（NetEase IM SDK，简称 NIM SDK）之后，您可以调用接口登录 IM 应用。账号登录成功后，应用才能正常调用收发消息和创建会话等其他 SDK 接口。本文介绍账号集成与登录的技术原理、实现 IM 登录及登出的流程、IM 登录状态转换流程，以及相关常见问题。

## 如何使用

- 请确保已根据 [接入流程](https://doc.yunxin.163.com/messaging2/guide/TEzOTczMDI?platform=client) 完成了以下步骤：
  - 创建应用并获取 App Key
  - 开通 IM 产品
  - 注册 IM 账号
- 登录详情请参考 [登录及登出 IM](https://doc.yunxin.163.com/messaging2/guide/Dk1MTY4MzA?platform=client)

## 场景演示

<SceneModule
  title="基础用法"
  description="登录、登出的基础用法"
  tsCode={BasicUseTypeScript}
  cssCode={BasicUseCss}
>
  <BasicUse />
</SceneModule>

## 方法列表

方法详情请参考：[API 文档](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/classes/src_V2NIMLoginService.V2NIMLoginService.html)

| 方法名                    | 入参                                                                                                                                                                                                  | 出参                                                                                                                                                                          | 说明                   |
| ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------- |
| login                     | accountId: string, token: string, loginOption?: [V2NIMLoginOption](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLoginService.html#V2NIMLoginOption) | Promise\<void\>                                                                                                                                                               | 登录接口               |
| logout                    | 无                                                                                                                                                                                                    | Promise\<void\>                                                                                                                                                               | 登出接口               |
| getLoginStatus            | 无                                                                                                                                                                                                    | [V2NIMLoginStatus](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/enums/src_V2NIMLoginService.V2NIMLoginStatus.html)                           | 获取登录状态           |
| getLoginUser              | 无                                                                                                                                                                                                    | string                                                                                                                                                                        | 获取当前登录用户       |
| getConnectStatus          | 无                                                                                                                                                                                                    | [V2NIMConnectStatus](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/enums/src_V2NIMLoginService.V2NIMConnectStatus.html)                       | 获取连接状态           |
| getCurrentLoginClient     | 无                                                                                                                                                                                                    | void \| [V2NIMLoginClient](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLoginService.html#V2NIMLoginClient)                 | 获取当前登录客户端信息 |
| getLoginClients           | 无                                                                                                                                                                                                    | [V2NIMLoginClient](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLoginService.html#V2NIMLoginClient)[]                       | 获取登录客户端列表     |
| kickOffline               | client: [V2NIMLoginClient](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLoginService.html#V2NIMLoginClient)                                         | Promise\<void\>                                                                                                                                                               | 踢下线指定客户端       |
| getKickedOfflineDetail    | 无                                                                                                                                                                                                    | null \| [V2NIMKickedOfflineDetail](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLoginService.html#V2NIMKickedOfflineDetail) | 获取被踢下线详情       |
| getDataSync               | 无                                                                                                                                                                                                    | null \| [V2NIMDataSyncDetail](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_SyncServiceInterface.html#V2NIMDataSyncDetail)[]      | 获取数据同步信息       |
| getChatroomLinkAddress    | roomId: string, miniProgram: boolean                                                                                                                                                                  | Promise\<string[]\>                                                                                                                                                           | 获取聊天室链接地址     |
| setAppVisibility          | isVisible: boolean                                                                                                                                                                                    | void                                                                                                                                                                          | 设置应用可见性         |
| setReconnectDelayProvider | fn: [V2NIMReconnectDelayProvider](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLoginService.html#V2NIMReconnectDelayProvider)                       | void                                                                                                                                                                          | 设置重连延迟提供者     |
| on                        | eventName: T, fn: Function                                                                                                                                                                            | void                                                                                                                                                                          | 添加事件监听器         |
| off                       | eventName: T, fn: Function                                                                                                                                                                            | void                                                                                                                                                                          | 移除事件监听器         |
| once                      | eventName: T, fn: Function                                                                                                                                                                            | void                                                                                                                                                                          | 添加一次性事件监听器   |
| removeAllListeners        | eventName?: T                                                                                                                                                                                         | void                                                                                                                                                                          | 移除所有监听器         |

## 事件列表

事件详情请参考 [API 文档](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/interfaces/src_V2NIMLoginService.V2NIMLoginListener.html)

| 服务              | 事件                 | 参数                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 说明             |
| ----------------- | -------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------- |
| V2NIMLoginService | onLoginStatus        | status: [V2NIMLoginStatus](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/enums/src_V2NIMLoginService.V2NIMLoginStatus.html)                                                                                                                                                                                                                                                                                                                   | 登录状态变更通知 |
| V2NIMLoginService | onConnectStatus      | status: [V2NIMConnectStatus](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/enums/src_V2NIMLoginService.V2NIMConnectStatus.html)                                                                                                                                                                                                                                                                                                               | 连接状态变更通知 |
| V2NIMLoginService | onLoginFailed        | error: [V2NIMError](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMError.html#V2NIMError)                                                                                                                                                                                                                                                                                                                                     | 登录鉴权失败通知 |
| V2NIMLoginService | onConnectFailed      | error: [V2NIMError](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMError.html#V2NIMError)                                                                                                                                                                                                                                                                                                                                     | 连接建立失败通知 |
| V2NIMLoginService | onDisconnected       | error: [V2NIMError](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMError.html#V2NIMError)                                                                                                                                                                                                                                                                                                                                     | 长连接断开通知   |
| V2NIMLoginService | onKickedOffline      | detail: [V2NIMKickedOfflineDetail](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLoginService.html#V2NIMKickedOfflineDetail)                                                                                                                                                                                                                                                                                                 | 被踢下线通知     |
| V2NIMLoginService | onLoginClientChanged | change: [V2NIMLoginClientChange](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/enums/src_V2NIMLoginService.V2NIMLoginClientChange.html), clients: [V2NIMLoginClient](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLoginService.html#V2NIMLoginClient)[]                                                                                                                                     | 多端登录通知     |
| V2NIMLoginService | onDataSync           | type: [V2NIMDataSyncType](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/enums/src_SyncServiceInterface.V2NIMDataSyncType.html), state: [V2NIMDataSyncState](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/enums/src_SyncServiceInterface.V2NIMDataSyncState.html), error?: [V2NIMError](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMError.html#V2NIMError) | 数据同步完成通知 |
