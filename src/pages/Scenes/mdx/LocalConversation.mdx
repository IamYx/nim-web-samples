import SceneModule from '@/components/SceneModule';

import BasicUse from '../modules/localConversation/BasicUse';
import BasicUseCss from '../modules/localConversation/BasicUse/index.module.less?raw';
import BasicUseTypeScript from '../modules/localConversation/BasicUse/index.tsx?raw';

# 本地会话

网易云信 IM 支持本地会话管理功能，包括创建、更新、删除本地会话等基础操作，以及置顶会话等进阶操作。本地会话列表由 SDK 维护并提供查询、监听变化的接口，当会话变更时，SDK 会自动更新会话列表并通知，您无需手动更新。

## 场景演示

<SceneModule
  title="基础用法"
  description="本地会话模块的基础用法，包括创建、更新、删除本地会话等。"
  tsCode={BasicUseTypeScript}
  cssCode={BasicUseCss}
>
  <BasicUse />
</SceneModule>

## 方法列表

方法详情请参考：[API 文档](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/classes/src_V2NIMLocalConversationService.V2NIMLocalConversationService.html)

| 方法名                      | 入参                                                                                                                                                                                                                             | 出参                                                                                                                                                                                                                     | 说明                   |
| --------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------- |
| clearTotalUnreadCount       | 无                                                                                                                                                                                                                               | Promise\<void\>                                                                                                                                                                                                          | 清除总未读数           |
| clearUnreadCountByIds       | conversationIds: string[]                                                                                                                                                                                                        | Promise\<[V2NIMLocalConversationOperationResult](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLocalConversationService.html#V2NIMLocalConversationOperationResult)[]\> | 根据会话ID清除未读数   |
| clearUnreadCountByTypes     | types: [V2NIMConversationType](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/enums/src_V2NIMConversationService.V2NIMConversationType.html)[]                                                    | Promise\<void\>                                                                                                                                                                                                          | 根据会话类型清除未读数 |
| createConversation          | conversationId: string                                                                                                                                                                                                           | Promise\<[V2NIMLocalConversation](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLocalConversationService.html#V2NIMLocalConversation)\>                                 | 创建会话               |
| deleteConversation          | conversationId: string, clearMessage?: boolean                                                                                                                                                                                   | Promise\<void\>                                                                                                                                                                                                          | 删除会话               |
| deleteConversationListByIds | conversationIds: string[], clearMessage?: boolean                                                                                                                                                                                | Promise\<[V2NIMLocalConversationOperationResult](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLocalConversationService.html#V2NIMLocalConversationOperationResult)[]\> | 批量删除会话           |
| getConversation             | conversationId: string                                                                                                                                                                                                           | Promise\<[V2NIMLocalConversation](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLocalConversationService.html#V2NIMLocalConversation)\>                                 | 获取单个会话           |
| getConversationList         | offset: number, limit: number                                                                                                                                                                                                    | Promise\<[V2NIMLocalConversationResult](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLocalConversationService.html#V2NIMLocalConversationOperationResult)\>            | 获取会话列表           |
| getConversationListByIds    | conversationIds: string[]                                                                                                                                                                                                        | Promise\<[V2NIMLocalConversation](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLocalConversationService.html#V2NIMLocalConversation)[]\>                               | 根据ID获取会话列表     |
| getConversationListByOption | offset: number, limit: number, option: [V2NIMLocalConversationOption](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLocalConversationService.html#V2NIMLocalConversationOption) | Promise\<[V2NIMLocalConversationResult](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLocalConversationService.html#V2NIMLocalConversationOperationResult)\>            | 根据选项获取会话列表   |
| getConversationReadTime     | conversationId: string                                                                                                                                                                                                           | Promise\<number\>                                                                                                                                                                                                        | 获取会话已读时间戳     |
| getStickTopConversationList | 无                                                                                                                                                                                                                               | Promise\<[V2NIMLocalConversation](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLocalConversationService.html#V2NIMLocalConversation)[]\>                               | 获取置顶会话列表       |
| getTotalUnreadCount         | 无                                                                                                                                                                                                                               | number                                                                                                                                                                                                                   | 获取总未读数           |
| getUnreadCountByFilter      | filter: [V2NIMLocalConversationFilter](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLocalConversationService.html#V2NIMLocalConversationFilter)                                | Promise\<number\>                                                                                                                                                                                                        | 根据过滤器获取未读数   |
| getUnreadCountByIds         | conversationIds: string[]                                                                                                                                                                                                        | Promise\<number\>                                                                                                                                                                                                        | 根据ID获取未读数       |
| markConversationRead        | conversationId: string                                                                                                                                                                                                           | Promise\<number\>                                                                                                                                                                                                        | 标记会话为已读         |
| on                          | eventName: T, fn: Function                                                                                                                                                                                                       | void                                                                                                                                                                                                                     | 添加事件监听器         |
| off                         | eventName: T, fn: Function                                                                                                                                                                                                       | void                                                                                                                                                                                                                     | 移除事件监听器         |
| once                        | eventName: T, fn: Function                                                                                                                                                                                                       | void                                                                                                                                                                                                                     | 添加一次性事件监听器   |
| removeAllListeners          | eventName?: T                                                                                                                                                                                                                    | void                                                                                                                                                                                                                     | 移除所有监听器         |

## 事件列表

事件详情请参考 [API 文档](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/interfaces/src_V2NIMLocalConversationService.V2NIMLocalConversationListener.html)

| 服务                          | 事件                          | 参数                                                                                                                                                                                                                   | 说明                     |
| ----------------------------- | ----------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------ |
| V2NIMLocalConversationService | onConversationChanged         | conversation: [V2NIMLocalConversation](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLocalConversationService.html#V2NIMLocalConversation)                            | 会话有更新               |
| V2NIMLocalConversationService | onConversationCreated         | conversation: [V2NIMLocalConversation](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLocalConversationService.html#V2NIMLocalConversation)                            | 会话被创建               |
| V2NIMLocalConversationService | onConversationDeleted         | conversationIds: string[]                                                                                                                                                                                              | 会话被删除               |
| V2NIMLocalConversationService | onConversationReadTimeUpdated | conversationId: string, readTime: number                                                                                                                                                                               | 会话已读时间戳更新       |
| V2NIMLocalConversationService | onSyncFailed                  | error: [V2NIMError](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/interfaces/src_types.V2NIMError.html)                                                                                | 会话模块数据同步失败     |
| V2NIMLocalConversationService | onSyncFinished                | 无                                                                                                                                                                                                                     | 会话模块数据同步结束     |
| V2NIMLocalConversationService | onSyncStarted                 | 无                                                                                                                                                                                                                     | 会话模块数据同步开始     |
| V2NIMLocalConversationService | onTotalUnreadCountChanged     | unreadCount: number                                                                                                                                                                                                    | 总未读数发生变化         |
| V2NIMLocalConversationService | onUnreadCountChangedByFilter  | filter: [V2NIMLocalConversationFilter](https://doc.yunxin.163.com/messaging2/references/web/typedoc/Latest/zh/v2/nim/modules/src_V2NIMLocalConversationService.html#V2NIMLocalConversationFilter), unreadCount: number | 指定过滤条件的未读数变化 |
